<mat-card style="max-width: 1100px; margin: 16px auto; padding: 12px;">
    <mat-card-title>Overdue Books</mat-card-title>

    <mat-progress-bar *ngIf="loading" mode="indeterminate" style="margin-top:10px;"></mat-progress-bar>

    <div *ngIf="error" style="color:#b00020; margin-top:10px;">
        {{ error }}
    </div>

    <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top: 14px;">
        <mat-form-field appearance="outline" style="min-width: 260px; flex:1;">
            <mat-label>Search</mat-label>
            <input matInput placeholder="book / isbn / user" [(ngModel)]="search" (keyup.enter)="apply()" />
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="apply()">
            <mat-icon>search</mat-icon>
            Search
        </button>

        <button mat-stroked-button (click)="clear()">
            <mat-icon>clear</mat-icon>
            Clear
        </button>
    </div>

    <div style="margin-top: 14px; overflow:auto;" *ngIf="paged">
        <table mat-table [dataSource]="paged.items" class="mat-elevation-z1" style="width:100%;">
            <ng-container matColumnDef="bookTitle">
                <th mat-header-cell *matHeaderCellDef>Book</th>
                <td mat-cell *matCellDef="let r">{{ r.bookTitle }}</td>
            </ng-container>

            <ng-container matColumnDef="borrowedByUsername">
                <th mat-header-cell *matHeaderCellDef>User</th>
                <td mat-cell *matCellDef="let r">{{ r.borrowedByUsername }}</td>
            </ng-container>

            <ng-container matColumnDef="dueAt">
                <th mat-header-cell *matHeaderCellDef>Due</th>
                <td mat-cell *matCellDef="let r">{{ r.dueAt | date:'mediumDate' }}</td>
            </ng-container>

            <ng-container matColumnDef="daysOverdue">
                <th mat-header-cell *matHeaderCellDef>Days Overdue</th>
                <td mat-cell *matCellDef="let r" style="color:#b00020; font-weight:600;">
                    {{ r.daysOverdue }}
                </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef style="width:120px;">Actions</th>
                <td mat-cell *matCellDef="let r">
                    <div class="action-row">
                        <button mat-icon-button color="warn" matTooltip="Return" matTooltipPosition="above"
                            (click)="returnBook(r)">
                            <mat-icon>assignment_return</mat-icon>
                        </button>
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>

    <div *ngIf="paged" style="margin-top: 14px; display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
        <button mat-stroked-button (click)="prev()" [disabled]="pageNumber <= 1">
            <mat-icon>chevron_left</mat-icon>
            Prev
        </button>

        <span style="opacity:.85;">
            Page <b>{{ paged.pageNumber }}</b> of <b>{{ paged.totalPages }}</b>
            ({{ paged.totalCount }} total)
        </span>

        <button mat-stroked-button (click)="next()" [disabled]="pageNumber >= paged.totalPages">
            Next
            <mat-icon>chevron_right</mat-icon>
        </button>
    </div>
</mat-card>